<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>IPTV Stereo VR</title>

  <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>

  <style>
    :root{--accent:#00d4ff;--bg:#050a10}
    body{margin:0;background:var(--bg);color:white;font-family:sans-serif;overflow:hidden}
    
    /* Panel de Control Flotante */
    .ui-overlay {
      position: absolute; top: 10px; left: 10px; z-index: 999;
      background: rgba(0,0,0,0.85); padding: 15px; border-radius: 12px;
      border: 1px solid var(--accent); width: 260px;
      transition: opacity 0.3s;
    }
    
    input, button { width: 100%; margin-bottom: 8px; padding: 12px; border-radius: 8px; border: none; box-sizing: border-box; }
    input { background: #111; color: white; border: 1px solid #333; }
    button { background: var(--accent); color: #000; font-weight: bold; cursor: pointer; }

    #master-container { width: 100vw; height: 100vh; position: relative; }
    
    /* Ocultar elementos */
    a-scene { display: none; }
    .vr-active a-scene { display: block !important; }
    .hidden { display: none !important; }
    
    /* Línea divisoria central para VR */
    .vr-line {
      position: absolute; left: 50%; top: 0; bottom: 0;
      width: 2px; background: rgba(255,255,255,0.2);
      z-index: 100; display: none;
    }
    .vr-active .vr-line { display: block; }
  </style>

  <script type="importmap">
    { "imports": { "hls.js": "https://esm.sh/hls.js@1.4.12" } }
  </script>
</head>
<body>

  <div class="ui-overlay" id="ui">
    <h3 style="margin:0 0 10px 0; color:var(--accent)">Stereo VR Player</h3>
    <input id="urlIn" type="text" placeholder="Link .m3u8 o YouTube">
    <button onclick="lanzarVR()">▶ INICIAR VR</button>
    <p style="font-size: 11px; color: #888; margin: 5px 0;">Pega el link y el modo VR dividirá la pantalla automáticamente.</p>
  </div>

  <div id="master-container">
    <div class="vr-line"></div>
    
    <video id="vidNormal" controls style="width:100%; height:100%; object-fit: contain;"></video>
    
    <a-scene id="escenaVR" embedded loading-screen="enabled: false" device-orientation-permission-ui="enabled: true">
      <a-assets>
        <video id="assetVid" autoplay crossorigin="anonymous" playsinline></video>
      </a-assets>

      <a-video src="#assetVid" width="8" height="4.5" position="-4.5 1.6 -10"></a-video>
      
      <a-video src="#assetVid" width="8" height="4.5" position="4.5 1.6 -10"></a-video>

      <a-entity camera look-controls position="0 1.6 0">
        <a-cursor color="var(--accent)" fuse="true" timeout="1500"></a-cursor>
      </a-entity>

      <a-sky color="#000"></a-sky>
    </a-scene>
  </div>

  <script type="module">
    import Hls from "hls.js";

    const vNormal = document.getElementById('vidNormal');
    const vVR = document.getElementById('assetVid');
    const container = document.getElementById('master-container');
    const hls = new Hls();

    window.lanzarVR = function() {
      const url = document.getElementById('urlIn').value.trim();
      if(!url) return alert("Pega un link primero");

      // Activar visualización dividida
      container.classList.add('vr-active');
      document.getElementById('ui').style.opacity = "0.1"; // Atenuar UI
      vNormal.classList.add('hidden');

      if (url.includes("youtube.com") || url.includes("youtu.be")) {
        // Nota: YouTube bloquea la duplicación directa por seguridad.
        // Se recomienda usar links directos .m3u8 para el efecto 3D real.
        alert("Para YouTube, usa el botón 'Mirar en RV' nativo del video que viste en tu captura.");
        container.classList.remove('vr-active');
        vNormal.classList.remove('hidden');
      } else {
        cargarStream(vVR, url);
      }
    }

    function cargarStream(elemento, url) {
      if (Hls.isSupported() && url.includes(".m3u8")) {
        hls.destroy();
        const newHls = new Hls();
        newHls.loadSource(url);
        newHls.attachMedia(elemento);
        newHls.on(Hls.Events.MANIFEST_PARSED, () => elemento.play());
      } else {
        elemento.src = url;
        elemento.play();
      }
    }
  </script>
</body>
</html>